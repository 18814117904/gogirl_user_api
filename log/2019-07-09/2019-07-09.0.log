2019-07-09 03:00:00,060 INFO (CouponService.java:190)- 每天定时任务,判断优惠券是否过期
2019-07-09 03:00:05,154 WARN (PoolBase.java:173)- HikariPool-1 - Failed to validate connection com.mysql.jdbc.JDBC4Connection@6c406ad7 (No operations allowed after connection closed.)
2019-07-09 03:00:10,161 WARN (PoolBase.java:173)- HikariPool-1 - Failed to validate connection com.mysql.jdbc.JDBC4Connection@1e945476 (No operations allowed after connection closed.)
2019-07-09 03:00:15,169 WARN (PoolBase.java:173)- HikariPool-1 - Failed to validate connection com.mysql.jdbc.JDBC4Connection@3a8bec21 (No operations allowed after connection closed.)
2019-07-09 03:00:20,181 WARN (PoolBase.java:173)- HikariPool-1 - Failed to validate connection com.mysql.jdbc.JDBC4Connection@20ce0c46 (No operations allowed after connection closed.)
2019-07-09 03:00:25,195 WARN (PoolBase.java:173)- HikariPool-1 - Failed to validate connection com.mysql.jdbc.JDBC4Connection@1e38e7f (No operations allowed after connection closed.)
2019-07-09 03:00:30,205 WARN (PoolBase.java:173)- HikariPool-1 - Failed to validate connection com.mysql.jdbc.JDBC4Connection@638a03a7 (No operations allowed after connection closed.)
2019-07-09 10:24:09,929 WARN (PoolBase.java:173)- HikariPool-1 - Failed to validate connection com.mysql.jdbc.JDBC4Connection@38310c0c (No operations allowed after connection closed.)
2019-07-09 10:24:09,941 WARN (PoolBase.java:173)- HikariPool-1 - Failed to validate connection com.mysql.jdbc.JDBC4Connection@3bbe1289 (No operations allowed after connection closed.)
2019-07-09 10:24:09,948 WARN (PoolBase.java:173)- HikariPool-1 - Failed to validate connection com.mysql.jdbc.JDBC4Connection@79279e89 (No operations allowed after connection closed.)
2019-07-09 10:24:09,959 WARN (PoolBase.java:173)- HikariPool-1 - Failed to validate connection com.mysql.jdbc.JDBC4Connection@49c6bccd (No operations allowed after connection closed.)
2019-07-09 10:24:09,963 WARN (PoolBase.java:173)- HikariPool-1 - Failed to validate connection com.mysql.jdbc.JDBC4Connection@7ca46726 (No operations allowed after connection closed.)
2019-07-09 10:24:09,967 WARN (PoolBase.java:173)- HikariPool-1 - Failed to validate connection com.mysql.jdbc.JDBC4Connection@37451861 (No operations allowed after connection closed.)
2019-07-09 10:24:09,970 WARN (PoolBase.java:173)- HikariPool-1 - Failed to validate connection com.mysql.jdbc.JDBC4Connection@72530bd6 (No operations allowed after connection closed.)
2019-07-09 10:24:09,973 WARN (PoolBase.java:173)- HikariPool-1 - Failed to validate connection com.mysql.jdbc.JDBC4Connection@e0ff185 (No operations allowed after connection closed.)
2019-07-09 10:24:09,977 WARN (PoolBase.java:173)- HikariPool-1 - Failed to validate connection com.mysql.jdbc.JDBC4Connection@51cd3a35 (No operations allowed after connection closed.)
2019-07-09 10:24:09,984 DEBUG (BaseJdbcLogger.java:159)- ==>  Preparing: select total_price,change_price,discount_price from order_manage WHERE department_id = ? 
2019-07-09 10:24:09,986 DEBUG (BaseJdbcLogger.java:159)- ==> Parameters: 17(Integer)
2019-07-09 10:24:10,046 DEBUG (BaseJdbcLogger.java:159)- <==      Total: 9
2019-07-09 10:24:10,191 DEBUG (BaseJdbcLogger.java:159)- ==>  Preparing: select count(distinct customer_id) from customer_balance WHERE customer_id in (select distinct customer_id from customer_balance_record where type=2 and department_id = ?) 
2019-07-09 10:24:10,192 DEBUG (BaseJdbcLogger.java:159)- ==> Parameters: 17(Integer)
2019-07-09 10:24:10,204 DEBUG (BaseJdbcLogger.java:159)- <==      Total: 1
2019-07-09 10:24:10,206 DEBUG (BaseJdbcLogger.java:159)- ==>  Preparing: select sum(order_amount) from customer_balance_record WHERE (type = 2 or type=1) and department_id = ? 
2019-07-09 10:24:10,207 DEBUG (BaseJdbcLogger.java:159)- ==> Parameters: 17(Integer)
2019-07-09 10:24:10,218 DEBUG (BaseJdbcLogger.java:159)- <==      Total: 1
2019-07-09 10:24:10,219 DEBUG (BaseJdbcLogger.java:159)- ==>  Preparing: select sum(balance) from customer_balance WHERE customer_id in (select distinct customer_id from customer_balance_record where department_id = ?) 
2019-07-09 10:24:10,246 DEBUG (BaseJdbcLogger.java:159)- ==> Parameters: 17(Integer)
2019-07-09 10:24:10,257 DEBUG (BaseJdbcLogger.java:159)- <==      Total: 1
2019-07-09 10:24:10,266 DEBUG (BaseJdbcLogger.java:159)- ==>  Preparing: select count(1) from customer c WHERE id in (select distinct order_user from order_manage where department_id = ?) 
2019-07-09 10:24:10,267 DEBUG (BaseJdbcLogger.java:159)- ==> Parameters: 17(Integer)
2019-07-09 10:24:10,277 DEBUG (BaseJdbcLogger.java:159)- <==      Total: 1
2019-07-09 10:24:10,280 DEBUG (BaseJdbcLogger.java:159)- ==>  Preparing: select count(1) from customer WHERE id in (select distinct customer_id from customer_department_relevance where department_id = ?) 
2019-07-09 10:24:10,280 DEBUG (BaseJdbcLogger.java:159)- ==> Parameters: 17(Integer)
2019-07-09 10:24:10,288 DEBUG (BaseJdbcLogger.java:159)- <==      Total: 1
2019-07-09 10:24:11,000 DEBUG (BaseJdbcLogger.java:159)- ==>  Preparing: select count(0) from customer WHERE (data_integrity is null or 0.8>data_integrity) and id in (select distinct order_user from order_manage where finish_time>'2019-05-27' and department_id = ? ) 
2019-07-09 10:24:11,001 DEBUG (BaseJdbcLogger.java:159)- ==> Parameters: 17(Integer)
2019-07-09 10:24:11,020 DEBUG (BaseJdbcLogger.java:159)- <==      Total: 1
2019-07-09 10:24:14,354 INFO (CustomerCotroller.java:496)- 获取用户信息，查询条件:Customer [id=null, openid=null, phone=null, nickname=null, password=null, sex=null, country=null, province=null, city=null, headimgurl=null, privilege=null, state=null, registerTime=null, updateTime=null, realName=null, birthday=null, registerDepartment=null, storeRecordRealName=null, remark=null, remark2=null, remark3=null, source=null, scheduledTimes=0, orderTimes=0, storeManage=null, customerBalance=null, customerDetail=null]
2019-07-09 10:24:14,457 DEBUG (BaseJdbcLogger.java:159)- ==>  Preparing: SELECT count(0) FROM (SELECT c.id, c.openid, c.phone, c.nickname, c.password, c.sex, c.country, c.province, c.city, c.headimgurl, c.privilege, c.state, c.register_time, c.update_time, c.real_name, c.birthday, c.register_department, c.customer_source, c.source, IFNULL(sm.scheduled_count, 0) scheduled_times, IFNULL(om.order_count, 0) order_times, c.store_record_real_name, c.remark, c.remark2, c.remark3, c.remark4, su.`name` AS responsible_person, data_integrity, s.id AS sid, s.store_no, s.logo, s.name, s.longitude, s.latitude, s.address, s.master, s.employee_number, s.customer_service_telphone, s.contact_name, s.contact_telphone, s.business_day, s.business_start_time, s.business_end_time, s.remark AS sremark, s.create_time, b.customer_id, b.balance, b.current_discount, b.first_charge_time, b.update_time AS bupdate_time, b.total_charge, b.total_bestow, b.total_expenditure, b.version, b.level, d.customer_id AS dcustomer_id, d.wechat_id, d.referee, d.first_serve_time, d.age, d.birthday AS dbirthday, d.marital_status, d.have_children, d.hobby, d.colour_of_skin, d.type_of_nail_bed, d.nail_type, d.nail_hardness, d.residence, d.work_address, d.occupation, d.frequency_of_nail, d.key_points_of_salon, d.like_style, d.customer_concerns, d.solution, d.eyelash_condition, d.eye_shape, d.questionnaire_img_url FROM customer c LEFT JOIN store_manage s ON c.register_department = s.id LEFT JOIN customer_balance b ON c.id = b.customer_id LEFT JOIN customer_detail d ON c.id = d.customer_id LEFT JOIN store_user su ON su.id = c.responsible_person LEFT JOIN (SELECT order_user, count(order_user) order_count FROM order_manage WHERE department_id = ? GROUP BY order_user) om ON c.id = om.order_user LEFT JOIN (SELECT scheduled_user, count(scheduled_user) scheduled_count FROM scheduled_manage WHERE department_id = ? GROUP BY scheduled_user) sm ON c.id = sm.scheduled_user WHERE c.id IN (SELECT customer_id FROM customer_department_relevance re WHERE re.department_id = ?) AND order_times >= ? AND scheduled_times >= ?) table_count 
2019-07-09 10:24:14,467 DEBUG (BaseJdbcLogger.java:159)- ==> Parameters: 17(Integer), 17(Integer), 17(Integer), 0(Integer), 0(Integer)
2019-07-09 10:24:14,484 DEBUG (BaseJdbcLogger.java:159)- <==      Total: 1
2019-07-09 10:24:14,485 DEBUG (BaseJdbcLogger.java:159)- ==>  Preparing: select c.id, c.openid, c.phone, c.nickname, c.password, c.sex, c.country, c.province, c.city, c.headimgurl, c.privilege, c.state, c.register_time, c.update_time, c.real_name, c.birthday, c.register_department,c.customer_source, c.source, IFNULL(sm.scheduled_count,0) scheduled_times,IFNULL(om.order_count,0) order_times, c.store_record_real_name, c.remark, c.remark2,c.remark3,c.remark4,su.`name` as responsible_person,data_integrity, s.id as sid, s.store_no, s.logo, s.name, s.longitude, s.latitude, s.address, s.master, s.employee_number, s. customer_service_telphone, s.contact_name, s.contact_telphone, s.business_day, s.business_start_time, s. business_end_time, s.remark as sremark, s.create_time, b.customer_id,b.balance,b.current_discount,b.first_charge_time,b.update_time as bupdate_time,b.total_charge, b.total_bestow,b.total_expenditure,b.version,b.level, d.customer_id as dcustomer_id, d.wechat_id, d.referee, d.first_serve_time, d.age, d.birthday as dbirthday, d.marital_status, d.have_children, d.hobby, d.colour_of_skin, d.type_of_nail_bed, d.nail_type, d.nail_hardness, d.residence, d.work_address, d.occupation, d.frequency_of_nail, d.key_points_of_salon, d.like_style, d.customer_concerns, d.solution, d.eyelash_condition, d.eye_shape, d.questionnaire_img_url from customer c left join store_manage s on c.register_department=s.id left join customer_balance b on c.id=b.customer_id left join customer_detail d on c.id=d.customer_id left join store_user su on su.id = c.responsible_person LEFT JOIN (select order_user,count(order_user) order_count from order_manage where department_id=? GROUP BY order_user ) om on c.id = om.order_user LEFT JOIN (select scheduled_user,count(scheduled_user) scheduled_count from scheduled_manage where department_id=? GROUP BY scheduled_user ) sm on c.id = sm.scheduled_user WHERE c.id in (select customer_id from customer_department_relevance re where re.department_id=?) and order_times>= ? and scheduled_times>= ? order by register_time desc LIMIT ? 
2019-07-09 10:24:14,486 DEBUG (BaseJdbcLogger.java:159)- ==> Parameters: 17(Integer), 17(Integer), 17(Integer), 0(Integer), 0(Integer), 10(Integer)
2019-07-09 10:24:14,527 DEBUG (BaseJdbcLogger.java:159)- <==      Total: 10
2019-07-09 10:24:18,061 DEBUG (BaseJdbcLogger.java:159)- ==>  Preparing: select customer_id, wechat_id, referee, first_serve_time, age, birthday, marital_status, have_children, hobby, colour_of_skin, type_of_nail_bed, nail_type, nail_hardness, residence, work_address, occupation, frequency_of_nail, key_points_of_salon, like_style, customer_concerns, solution, eyelash_condition, eye_shape, questionnaire_img_url,learn_about_us from customer_detail where customer_id = ? 
2019-07-09 10:24:18,063 DEBUG (BaseJdbcLogger.java:159)- ==> Parameters: 1803(Integer)
2019-07-09 10:24:18,074 DEBUG (BaseJdbcLogger.java:159)- <==      Total: 1
2019-07-09 10:24:19,585 INFO (CustomerCotroller.java:303)- 修改用户信息：Customer [id=1803, openid=null, phone=null, nickname=null, password=null, sex=null, country=null, province=null, city=null, headimgurl=null, privilege=null, state=null, registerTime=null, updateTime=null, realName=null, birthday=null, registerDepartment=null, storeRecordRealName=null, remark=null, remark2=null, remark3=null, source=null, scheduledTimes=null, orderTimes=null, storeManage=null, customerBalance=null, customerDetail=null]
2019-07-09 10:24:19,586 INFO (CustomerService.java:89)- 更新用户信息record:Customer [id=1803, openid=null, phone=null, nickname=null, password=null, sex=null, country=null, province=null, city=null, headimgurl=null, privilege=null, state=null, registerTime=null, updateTime=null, realName=null, birthday=null, registerDepartment=null, storeRecordRealName=null, remark=null, remark2=null, remark3=null, source=null, scheduledTimes=null, orderTimes=null, storeManage=null, customerBalance=null, customerDetail=null]
2019-07-09 10:24:19,596 DEBUG (BaseJdbcLogger.java:159)- ==>  Preparing: select customer_id, wechat_id, referee, first_serve_time, age, birthday, marital_status, have_children, hobby, colour_of_skin, type_of_nail_bed, nail_type, nail_hardness, residence, work_address, occupation, frequency_of_nail, key_points_of_salon, like_style, customer_concerns, solution, eyelash_condition, eye_shape, questionnaire_img_url,learn_about_us from customer_detail where customer_id = ? 
2019-07-09 10:24:19,598 DEBUG (BaseJdbcLogger.java:159)- ==> Parameters: 1803(Integer)
2019-07-09 10:24:19,609 DEBUG (BaseJdbcLogger.java:159)- <==      Total: 1
2019-07-09 10:25:11,363 DEBUG (BaseJdbcLogger.java:159)- ==>  Preparing: update customer SET update_time = ?, customer_source = ?, data_integrity=? where id = ? 
2019-07-09 10:25:11,365 DEBUG (BaseJdbcLogger.java:159)- ==> Parameters: 2019-07-09 10:24:19.586(Timestamp), 2(Integer), 0.6000000000000001(Double), 1803(Integer)
2019-07-09 10:25:11,384 DEBUG (BaseJdbcLogger.java:159)- <==    Updates: 1
2019-07-09 12:00:00,048 INFO (CouponService.java:177)- 每天定时任务,查看优惠券是否即将过期,发起消息模板提醒
2019-07-09 12:00:05,488 WARN (PoolBase.java:173)- HikariPool-1 - Failed to validate connection com.mysql.jdbc.JDBC4Connection@1ae15def (No operations allowed after connection closed.)
2019-07-09 12:00:10,493 WARN (PoolBase.java:173)- HikariPool-1 - Failed to validate connection com.mysql.jdbc.JDBC4Connection@38c69a29 (No operations allowed after connection closed.)
2019-07-09 12:00:15,497 WARN (PoolBase.java:173)- HikariPool-1 - Failed to validate connection com.mysql.jdbc.JDBC4Connection@2836542d (No operations allowed after connection closed.)
2019-07-09 12:00:20,500 WARN (PoolBase.java:173)- HikariPool-1 - Failed to validate connection com.mysql.jdbc.JDBC4Connection@4da1df0e (No operations allowed after connection closed.)
2019-07-09 12:00:25,503 WARN (PoolBase.java:173)- HikariPool-1 - Failed to validate connection com.mysql.jdbc.JDBC4Connection@41ba1341 (No operations allowed after connection closed.)
2019-07-09 12:00:30,525 WARN (PoolBase.java:173)- HikariPool-1 - Failed to validate connection com.mysql.jdbc.JDBC4Connection@20a3b0b8 (No operations allowed after connection closed.)
